<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Welcome to the Wonderland</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Amatic+SC&display=swap">
    <style>
        /* Define font family */
        body, h1, h2, .discover-button {
            font-family: 'Amatic SC', cursive;
        }
        
        /* Set background color of the entire page to yellow */
        body {
            background-color: #f9ccca ;
        }

        .container {
            max-width: 700px; /* Set maximum width to prevent video container from being pushed */
            margin: 0 auto; /* Center the container horizontally */
            text-align: center; /* Center the content inside the container */
        }

        .video-container {
            position: relative; /* Ensure button is positioned relative to this container */
            border-radius: 25px;
            border: 5px solid #212aad;
            padding: 0px;
            width: 100%; /* Set the width of the video container to 100% */
            height: auto; /* Allow it to adjust based on video size */
            text-align: center;
            position: relative; /* Make it relative to the container */
            cursor: pointer; /* Add cursor pointer on hover */
        }

        .container img {
            max-width: 100%; /* Make sure the image inside video-container doesn't overflow */
        }

        /* Style for discover button */
        .discover-button {
            position: absolute; /* Position the button relative to the video container */
            bottom: 20px; /* Adjust button's distance from the bottom */
            left: 50%; /* Align button horizontally */
            transform: translateX(-50%); /* Center the button horizontally */
            padding: 10px 20px; /* Adjust button padding */
            font-size: 16px; /* Adjust button font size */
            background-color: #212aad; /* Button background color */
            color: white; /* Button text color */
            border: none; /* Remove button border */
            border-radius: 5px; /* Add border radius */
            cursor: pointer; /* Add cursor pointer on hover */
        }

        .fruit-images {
            border: solid 1px #eeeeee; /* for debugging display */
            padding: 0.5vw;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-auto-rows: 24.5vw;
            grid-gap: 0.5vw; /* optional gutter, use "vw" instead of "px" to keep proportions responsive */
        }

        .fruit-images img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border: solid 1px #000; /* add a border to each image */
        }

        .popup-text {
            display: none;
        }   

        /* Style for close button */
        .close-button {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: pointer;
        }
    </style>
</head>
  
<body>
    <div class="container">
        <div class="row" style="text-align: center;">
            <h1 style="text-align: center; display:inline-block; font-size: 70px;">Welcome to Wonderland of Fruits!</h1>
        </div>
    </div>

    <div class="container">
        <div class="video-container">
            <img src="{{ url_for('video') }}" class="container"></img>
            <!-- Popup text -->
            <div class="popup-text">
                <p id="object-description">This is an apple. Apples are a popular fruit with a sweet taste.</p>
                <!-- Close button -->
                <span class="close-button" onclick="closePopup()">X</span>
            </div>
            <!-- Discover button -->
            <button class="discover-button" onclick="showFruitInfo()">Discover</button>
        </div>
    </div>

    <!-- Container to display detected fruit images -->
    <div class="container fruit-images" style="display: none;">
        <!-- Images will be dynamically added here -->
    </div>

    <script>
        function showFruitImages() {
            // Get the container for fruit images
            var fruitImagesContainer = document.querySelector('.fruit-images');

            // Dummy data - replace this with actual data received from image detection
            var fruitImages = [
                'https://www.shutterstock.com/image-photo/red-apple-isolated-on-white-600nw-1727544364.jpg',
                'https://www.news.wisc.edu/story_images/871/original/apple-slice.jpg',
                'https://thumbs.dreamstime.com/b/green-apple-clipping-path-19314372.jpg'
                // Add more image URLs as needed
            ];

            // Clear previous content
            fruitImagesContainer.innerHTML = '';

            // Create and append image elements
            fruitImages.forEach(function(imageUrl) {
                var img = document.createElement('img');
                img.src = imageUrl;
                fruitImagesContainer.appendChild(img);
            });

            // Show the container
            fruitImagesContainer.style.display = 'block';
        }

        // Show popup text and trigger speech when "Discover" button is clicked
        function showFruitInfo() {
            fetchDescription().then(description => {
                document.getElementById('object-description').innerText = description;
                document.querySelector('.popup-text').style.display = 'block';
                playSpeech(description); // Play speech for the current description
            });
            showFruitImages(); // Call this function if you want to also show the fruit images when the popup is displayed
        }

        // Close popup text when clicking the close button
        function closePopup() {
            document.querySelector('.popup-text').style.display = 'none';
        }

        // Function to fetch the detected object description from the server
        function fetchDescription() {
            return fetch('/get_detected_object')
                .then(response => response.json())
                .then(data => data.description)
                .catch(error => {
                    console.error('Error:', error);
                    return 'Description not available.';
                });
        }

        // Function to play speech
        function playSpeech(text) {
            // Use fetch or other appropriate method to send the text to your server-side script to generate speech and return the speech URL
            fetch('/generate_speech', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ text: text })
            })
            .then(response => response.json())
            .then(data => {
                // Use the returned speech URL to play the speech
                var audio = new Audio(data.speech_url);
                audio.play();
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>
